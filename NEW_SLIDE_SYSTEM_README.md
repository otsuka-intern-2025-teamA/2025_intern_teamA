# 新スライド生成システム - ユーザーガイド

## 概要

このシステムは、営業マンがB2B提案用のプレゼンテーションを自動生成するためのAI駆動システムです。Azure OpenAI APIとTAVILY APIを活用して、企業の課題と提案製品に基づいたプレゼンテーションを作成します。

## 主な機能

### 🤖 AIエージェント機能
- **自動変数生成**: 商談情報からプレゼンテーション用変数を自動生成
- **課題分析**: 商談メモとチャット履歴から企業の課題を抽出
- **製品推奨理由**: 各製品の選択理由を自動生成
- **効果予測**: 導入による期待効果を分析

### 📋 テンプレート処理機能
- **PowerPoint対応**: .pptxファイルの直接編集
- **フォーマット保持**: 元のテキストの色、サイズ、フォントを保持
- **変数置換**: プレースホルダー変数を実際の内容で置換
- **検証機能**: 変数の妥当性を事前チェック

### 🚀 統合システム
- **Streamlit UI**: 使いやすいWebインターフェース
- **データベース連携**: 既存の案件管理システムと連携
- **設定可能**: GPT APIとTAVILY APIの使用を個別制御

## システム構成

```
apps/streamlit/lib/
├── ai_agent.py              # AIエージェント（変数生成）
├── template_processor.py    # テンプレート処理
├── new_slide_generator.py   # メイン生成システム
└── __init__.py             # パッケージ初期化
```

## 必要な環境変数

`.env`ファイルに以下の設定が必要です：

```bash
# Azure OpenAI設定
AZURE_OPENAI_ENDPOINT=https://lab-teama.openai.azure.com/
AZURE_OPENAI_API_KEY=your_api_key_here
AZURE_OPENAI_EMBED_DEPLOYMENT=gpt-5-mini

# TAVILY設定
TAVILY_API_KEY=your_tavily_api_key_here
```

## 使用方法

### 1. 基本的な使用手順

1. **案件選択**: 案件一覧から対象企業を選択
2. **商談詳細入力**: 商談の詳細を入力
3. **参考資料アップロード**: 必要に応じて資料をアップロード
4. **候補取得**: 製品候補を検索・選択
5. **スライド生成**: AIエージェントがプレゼンテーションを生成
6. **ダウンロード**: 生成されたプレゼンテーションをダウンロード

### 2. AI設定

- **GPT API使用**: Azure OpenAI APIを使用して高度な内容生成
- **TAVILY API使用**: Web検索による最新情報の取得
- **TAVILY使用回数**: 製品あたりのWeb検索回数（1-5回）

### 3. 生成される変数

#### 基本変数
- `{{PROJECT_NAME}}`: プロジェクト名
- `{{COMPANY_NAME}}`: 企業名
- `{{AGENDA_BULLETS}}`: アジェンダ（箇条書き）
- `{{CHAT_HISTORY_SUMMARY}}`: チャット履歴サマリー（400文字以内）

#### 課題・提案変数
- `{{PROBLEM_HYPOTHESES}}`: 課題仮説（400文字以内）
- `{{PROPOSAL_SUMMARY}}`: 提案サマリー（400文字以内）
- `{{EXPECTED_IMPACTS}}`: 期待効果（400文字以内）

#### 製品変数（動的生成）
- `{{PRODUCTS[1].NAME}}`: 製品1の名前
- `{{PRODUCTS[1].CATEGORY}}`: 製品1のカテゴリ
- `{{PRODUCTS[1].PRICE}}`: 製品1の価格（米ドル）
- `{{PRODUCTS[1].REASON}}`: 製品1の選択理由

#### 実装計画変数
- `{{TOTAL_COSTS}}`: 総コスト
- `{{SCHEDULE_PLAN}}`: 導入スケジュール（400文字以内）
- `{{NEXT_ACTIONS}}`: 次のアクション（400文字以内）

## テンプレートファイル

### 要件
- **形式**: PowerPoint (.pptx)
- **場所**: `template/proposal_template.pptx`
- **変数記法**: `{{VARIABLE_NAME}}`形式

### カスタマイズ
1. 元のテンプレートファイルを編集
2. 必要な箇所に変数プレースホルダーを配置
3. フォーマット（色、サイズ、フォント）を設定
4. システムが自動的に変数を置換

## 技術仕様

### 対応API
- **Azure OpenAI**: GPT-5-mini, text-embedding-3-large
- **TAVILY**: Web検索API

### ファイル形式
- **入力**: .pptx（PowerPoint）
- **出力**: .pptx（PowerPoint）
- **データ**: SQLite（既存システム）

### パフォーマンス
- **処理時間**: 通常30秒-2分
- **ファイルサイズ**: 元テンプレートに依存
- **メモリ使用量**: 最小限（一時ファイル使用）

## トラブルシューティング

### よくある問題

#### 1. テンプレートファイルが見つからない
```
FileNotFoundError: テンプレートファイルが見つかりません
```
**解決方法**: `template/proposal_template.pptx`ファイルの存在を確認

#### 2. API接続エラー
```
Azure設定不足: AZURE_OPENAI_ENDPOINT / AZURE_OPENAI_API_KEY
```
**解決方法**: `.env`ファイルの設定を確認

#### 3. 変数置換が動作しない
**解決方法**: 
- テンプレート内の変数記法が正しいか確認
- 変数名の大文字・小文字を確認
- プレースホルダーが正しく配置されているか確認

### ログ確認
システムの動作状況は以下のログで確認できます：
- コンソール出力（詳細ログ）
- Streamlit UI（基本情報）
- エラーメッセージ（問題箇所）

## テスト

システムの動作確認には、以下のテストスクリプトを使用してください：

```bash
python test_new_slide_system.py
```

このスクリプトは以下をテストします：
- モジュールのインポート
- AIエージェントの初期化
- テンプレート処理
- 統合システムの動作

## 開発者向け情報

### アーキテクチャ
- **モジュラー設計**: 各機能を独立したモジュールとして実装
- **エラーハンドリング**: 各段階での適切なエラー処理
- **フォールバック**: API利用不可時の代替処理

### 拡張性
- **新しい変数**: `ai_agent.py`に新しい生成ロジックを追加
- **テンプレート対応**: 他のファイル形式への対応も可能
- **API統合**: 他のAIサービスとの連携も容易

### カスタマイズポイント
1. **AIエージェント**: プロンプトエンジニアリング
2. **テンプレート処理**: 新しいファイル形式対応
3. **変数生成**: ビジネスロジックの調整

## ライセンス・サポート

このシステムは社内利用を目的として開発されています。技術的な質問や改善提案については、開発チームまでお問い合わせください。

---

**最終更新**: 2025年1月
**バージョン**: 1.0.0
**開発チーム**: Team A
